<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="echo.sp.app.dao.UserOrderDAO">

	<insert id="addOrderHead" parameterType="map">
	    INSERT INTO T_ORDERS(ORDER_ID,MERCHANT_ID,USER_ID,ORDER_TYPE,STATUS,ORDER_TIME,TOTAL_PAY)
        VALUES(#{ORDER_ID},#{MERCHANT_ID},#{USER_ID},#{ORDER_TYPE},'10',#{ORDER_TIME},#{TOTAL_PAY,jdbcType=NUMERIC})
    </insert>
    <insert id="addOrderLine" parameterType="java.util.List">
	   	INSERT INTO T_ORDERS_LINE(ORDER_ID,ITEM_ID,ITEM_NAME,QTY_SOLD,PAY_PRICE,SINGLE_PAY) VALUES
    	<foreach collection="list" item="itm" separator=",">
	       (#{itm.ORDER_ID},#{itm.ITEM_ID},#{itm.ITEM_NAME},
	        #{itm.QTY_SOLD,jdbcType=NUMERIC},
	        #{itm.PAY_PRICE,jdbcType=NUMERIC},
	        #{itm.SINGLE_PAY,jdbcType=NUMERIC})
	    </foreach>
 	</insert>
 	<update id="modifyItemQty" parameterType="java.util.List">  
	    <foreach collection="list" item="item" index="index" open="" close="" separator=";">
	        UPDATE T_ITEMS
	        <set>
	            INVENTORY = #{item.INVENTORY,jdbcType=NUMERIC},
	            QTY_SOLD = #{item.QTY_SOLD_REAL,jdbcType=NUMERIC}
	        </set>
	        WHERE ITEM_ID = #{item.ITEM_ID}
	    </foreach>  
	</update>
 	
 	
 	<select id="getOrderHead" parameterType="map" resultType="Map">
    	SELECT * FROM T_ORDERS WHERE ORDER_ID = #{ORDER_ID}
    </select>
    <select id="getOrderLine" parameterType="map" resultType="Map">
    	SELECT * FROM T_ORDERS_LINE WHERE ORDER_ID = #{ORDER_ID}
    </select>
    
</mapper>